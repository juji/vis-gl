# Check for remote changes and build if needed
branch=$(git rev-parse --abbrev-ref HEAD)

echo "🔍 Fetching origin on $branch..."

if git fetch origin "$branch" 2>/dev/null; then
  if git diff --quiet HEAD origin/"$branch"; then
    echo "✅ No changes detected from origin. Skipping build."
  else
    echo "🔄 Changes detected. Merging and building..."
    if git merge origin/"$branch" --no-edit; then
      echo "🔨 Building project..."
      if pnpm run build; then
        echo "✅ Pre-push checks completed successfully!"
      else
        echo "❌ Build failed! Please fix build errors before pushing."
        exit 1
      fi
    else
      echo "❌ Merge failed! Please resolve conflicts and try again."
      exit 1
    fi
  fi
else
  echo "⚠️  Could not fetch from remote..."
  exit 1
fi
